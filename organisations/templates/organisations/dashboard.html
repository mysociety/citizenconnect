{% extends 'base.html' %}
{% load url from future %}
{% load organisation_extras %}

{% block title %}{{ organisation.name }} Dashboard{% endblock %}

{% block bodyclasses %}organisation-dashboard{% endblock %}

{% block content %}
<div class="header">
    <h1>{{ organisation.name }} Dashboard</h1>
</div>

<div class="island  island--aquablue">
    <div class="gw">
        {% if organisation.has_time_limits  %}

            <p class="g  one-half  palm-one-whole  feature">
                {% if problems_total.average_time_to_address != None %}
                    <span class="feature__num">{{ problems_total.average_time_to_address|formatted_time_interval }}</span><span class="feature__text">{% if problems_total.average_time_to_address|formatted_time_interval == '1' %} day {% else %} days {% endif %} on average to address problems</span>
                {% else %}
                    <span class="feature__text">No data on time taken to address problems</span>
                {% endif %}
            </p>

        {% endif %}
    <p class="g  {% if organisation.has_time_limits  %}one-half{% else %}one-whole{% endif %} palm-one-whole  feature">
            {% if problems_total.happy_service != None %}
               <span class="feature__num">{{ problems_total.happy_service|percent }}</span><span class="feature__text"> of users happy with service</span>
            {% else %}
                <span class="feature__text">No data on users happy with service</span>
             {% endif %}
         </p>
    </div>
</div>

    <div class="feature">
        <p><a href="{% url 'private-org-summary' ods_code=organisation.ods_code %}">More stats</a></p>
    </div>

<div class="issues-table">
    <div class="feature">
        <table>
            <thead>
                <tr>
                    <th>Ref</th>
                    <th>Issue Type</th>
                    <th>Received</th>
                    <th>Name</th>
                    <th>Issue snippet</th>
                    <th>Breach</th>
                    <th>Status</th>
                    <th>Moderated</th>
                </tr>
            </thead>
            <tbody>
                {% for problem in problems %}
                    <tr>
                        <td>{{ problem.reference_number }}</td>
                        <td>{{ problem.issue_type }}</td>
                        <td>{{ problem.created }}</td>
                        <td>{{ problem.reporter_name_display }}</td>
                        <td><a href="{% url 'response-form' pk=problem.id %}">{{ problem.private_summary }}</a></td>
                        <td>{% if problem.breach %}
                            <span class="icon-warning" aria-hidden="true"></span>
                            <span class="hide-text">Yes</span>
                            {% else %}
                            <span class="icon-circle icon-hidden" aria-hidden="true"></span>
                            <span class="hide-text">No</span>
                            {% endif %}
                        </td>
                        <td>{{ problem.get_status_display }}</td>
                        <td>{% if problem.moderated %}
                                <span class="icon-checkmark" aria-hidden="true"></span>
                                <span class="hide-text">Yes</span>
                            {% else %}
                                <span class="icon-x" aria-hidden="true"></span>
                                <span class="hide-text">No</span>
                            {% endif %}
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}
