{% extends 'base.html' %}
{% load url from future %}

{% load staticfiles %}

{% block title %}Organisation performance data{% endblock %}

{% block bodyclasses %}outcomes-map{% endblock %}

{% block content %}

<div class="gw">
    <div class="g  two-thirds  palm-one-whole  mb__palm">
        <p>The map shows the number of problems that have been submitted. A blue dot marks the location of the participating NHS providers. The darker the shade of blue, the higher the number of 'open' and 'in progress' problems there are.</p>

        <ul>
            <li>Click on the dot to see a summary for that NHS provider</li>
            <li>Click on 'View problems' to see the details and how the NHS is responding</li>
        </ul>

        <p>A problem fixed is a positive outcome for you and for the NHS!</p>
    </div>
    <div class="g  one-third  palm-one-whole">
        <a href="{% url 'org-all-summary' cobrand=cobrand.name %}"  class="btn  btn--no-border  btn--big  btn--blue">See All Participating Service Providers <br><small>Click here</small></a>
    </div>
</div>

{% include 'organisations/includes/filters.html' %}

<ul class="tab-nav">
    <li><a href="#" id="london" class="active">London</a></li>
    <li><a href="#" id="northeast">North East England</a></li>
</ul>

<div class="map-search-controls">
  <select id="map-search-org-name" placeholder="Choose organisation name">
    {% for org in name_search_organisations %}
      <option value="{{ org.id }}">{{ org.name }}</option>
    {% endfor %}
  </select>
</div>

<div class="map-container">
    <div id="map" class="map"></div>
</div>

<div class="gw">
    <div class="g  one-fifth  palm-one-whole  scale">
        <img class="scale-image" src="{% static 'img/problem_scale.png' %}" />
        <small class="meta-data-label">Fewer</small>
        <small class="meta-data-label  fr">More</small>
    </div>
    <div class="g  four-fifths  palm-one-whole">
        <p>
            <small>A higher number of problems (the darker the dot) does not necessarily indicate a poorly performing NHS provider - it could be that they are actively progressing problems and encouraging people to report them. Check out their summary to see how they are doing.</small>
        </p>
    </div>
</div>

{% include 'emergency_numbers.html' %}

{% endblock content %}

{% block extra_js %}
{{ block.super }}
<script src="{% static 'js/underscore.min.js' %}"></script>
<script src="{% static 'js/leaflet.js' %}"></script>
<script src="{% static 'js/wax.leaf.min.js' %}"></script>
<script src="{% static 'js/oms.min.js' %}"></script>
<script src="{% static 'js/spin.min.js' %}"></script>
<script src="{% static 'js/jquery.spin.js' %}"></script>
<script type="text/javascript">
    window.CitizenConnect = window.CitizenConnect || {};
    CitizenConnect.providers = {{ organisations|safe }};
</script>

<script type="text/x-underscore-template" name="hover-bubble">
    <div class="hover-bubble  cf">
        <div class="header">
            <img src="<%= icon.options.iconRetinaUrl %>" alt="Status icon" class="fr" />
            <h1 class="map-header"><%= nhsCentre.name %></h1>
        </div>
        <h2 class="map-header">Problem reports</h2>
        <% if (issueType !== '') { %>
            <h3>Issue Type - <%= issueType %></h3>
        <% } %>
        <ul class="unstyled">
            <li><em><%= nhsCentre.all_time_open %></em> Open/In progress issues</li>
            <li><em><%= nhsCentre.all_time_closed %></em> Closed issues</li>
            <% if (nhsCentre.average_time_to_address) { %>
                <li><em><%= nhsCentre.average_time_to_address %></em> days average time to close</li>
            <% } %>
            <% if (nhsCentre.happy_outcome) { %>
                <li><em><%= nhsCentre.happy_outcome %></em> users satisfied with resolution</li>
            <% } %>
        </ul>
        <h2 class="map-header">Ratings and Reviews</h2>
        <% if (nhsCentre.average_recommendation_rating) { %>
        <p>
            Average Rating
            <span class="rating">
                <span class="<%= starClass(nhsCentre.average_recommendation_rating, 1) %>" aria-hidden="true"></span>
                <span class="<%= starClass(nhsCentre.average_recommendation_rating, 2) %>" aria-hidden="true"></span>
                <span class="<%= starClass(nhsCentre.average_recommendation_rating, 3) %>" aria-hidden="true"></span>
                <span class="<%= starClass(nhsCentre.average_recommendation_rating, 4) %>" aria-hidden="true"></span>
                <span class="<%= starClass(nhsCentre.average_recommendation_rating, 5) %>" aria-hidden="true"></span>
            </span>
        </p>
        <% } %>
        <p><%= nhsCentre.reviews_all_time %> Review<%= nhsCentre.reviews_all_time !== 1 ? 's' : '' %> received</p>
        <span class="fr"><a href="<%= nhsCentre.url %>">View problems <span class="icon-chevron-right" aria-hidden="true"></span></a></span>
    </div>
</script>

<script src="{% static 'js/select2.min.js' %}"></script>
<script src="{% static 'js/map.js' %}"></script>
{% endblock extra_js %}


{% block extra_css %}
    <link rel="stylesheet" href="{% static 'css/select2/select2.css' %}" />
{% endblock extra_css %}
