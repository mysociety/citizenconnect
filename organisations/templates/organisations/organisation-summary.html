{% extends 'base.html' %}
{% load url from future %}
{% load organisation_extras %}
{% block title %}{{ organisation.name }} :: Outcomes Summary{% endblock %}

{% block bodyclasses %}organisation-summary{% endblock %}

{% block content %}
<div class="header">
    <h1>{{ organisation.name }} Outcomes</h1>
</div>
{% include "organisations/includes/summary-tabs.html" with active_tab='summary' %}

<div class="hero">
    {% if organisation.has_time_limits  %}
    <div class="feature">
        {% if issues_total.average_time_to_acknowledge != None %}
            <p>Average days to acknowledge: {{ issues_total.average_time_to_acknowledge|formatted_time_interval }} </p>
        {% else %}
            <p>No data on time taken to acknowledge problems</p>
        {% endif %}
    </div>
    <div class="feature">
        {% if issues_total.average_time_to_address != None %}
            <p>Average days to address: {{ issues_total.average_time_to_address|formatted_time_interval }} </p>
        {% else %}
            <p>No data on time taken to address problems</p>
        {% endif %}
    </div>
    {% endif %}
    <div class="feature">
        {% if issues_total.happy_service != None %}
            <p class="brief">{{ issues_total.happy_service|percent }} of users happy with service</p>
        {% else %}
            <p class="brief">No data on users happy with service</p>
        {% endif %}
    </div>
    <div class="feature">
        {% if issues_total.happy_outcome != None %}
            <p class="brief">{{ issues_total.happy_outcome|percent }} of users happy with outcome</p>
        {% else %}
            <p class="brief">No data on users happy with outcome</p>
        {% endif %}
    </div>
</div>
<div class="outcomes-options">
    <form class="" action="{{ request.path }}">
        {% if services %}
        <div class="feature">
            <select name="service">
                <option value="">Department</option>
                {% for service in services %}
                <option value="{{ service.id }}" {% if selected_service == service.id %}selected{% endif %}>{{ service.name }}</option>
                {% endfor %}
            </select>
        </div>
        {% endif %}
        <div class="feature">
            <select name="problems_category">
                <option value="">Problem type</option>
                {% for value, display_value in problems_categories %}
                <option value="{{ value }}" {% if problems_category == value %}selected{% endif %}>{{ display_value }}</option>
                {% endfor %}
            </select>
        </div>
        <div class="feature">
            <input type="submit" value="Filter">
        </div>
    </form>
</div>
<div class="outcomes-table">
    <div class="feature">
        <table>
            <thead>
                <tr>
                    <th class="heading separator">Message Type</th>
                    <th>Last 7 days</th>
                    <th>Last 4 weeks</th>
                    <th>Last 6 months</th>
                    <th class="separator">All time</th>
                    {% if organisation.has_time_limits %}
                        <th>Average days to acknowledge</th>
                        <th class="separator">Average days to address</th>
                    {% endif %}
                    <th>% Happy with service</th>
                    <th>% Happy with outcome</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td class="heading separator">Total Problems Reported<br/><em>of which:</em></td>
                    <td>{{ problems_total.week }}</td>
                    <td>{{ problems_total.four_weeks }}</td>
                    <td>{{ problems_total.six_months }}</td>
                    <td class="separator">{{ problems_total.all_time }}</td>
                    {% if organisation.has_time_limits %}
                        <td>{{ problems_total.average_time_to_acknowledge|formatted_time_interval }}</td>
                        <td class="separator">{{ problems_total.average_time_to_address|formatted_time_interval }}</td>
                    {% endif %}
                    <td>{{ problems_total.happy_service|percent }}
                    </td>
                    <td>{{ problems_total.happy_outcome|percent }}
                    </td>
                </tr>
                {% for status in problems_by_status %}
                <tr>

                    <td class="heading separator">{{ status.description }}</td>
                    <td>{{ status.week }}</td>
                    <td>{{ status.four_weeks }}</td>
                    <td>{{ status.six_months }}</td>
                    <td class="separator">{{ status.all_time }}</td>
                    {% if organisation.has_time_limits %}
                        <td>{{ status.average_time_to_acknowledge|formatted_time_interval }}</td>
                        <td class="separator">{{ status.average_time_to_address|formatted_time_interval }}</td>
                    {% endif %}
                    <td>{{ status.happy_service|percent }}</td>
                    <td>{{ status.happy_outcome|percent }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}
