{% extends 'base.html' %}
{% load url from future %}
{% load organisation_extras %}
{% block title %}{{ organisation.name }} :: Outcomes Summary{% endblock %}

{% block bodyclasses %}organisation-summary{% endblock %}

{% block content %}
<div class="header">
    <h1>{{ organisation.name }} Outcomes</h1>
</div>
{% include "organisations/includes/summary-tabs.html" with active_tab='summary' %}

<div class="hero">
    {% if organisation.has_time_limits %}
    <div class="feature">
        {% with percent_acknowledged=issues_total|true_to_false_percent:'acknowledged_in_time' %}
        {% if percent_acknowledged == '-' %}
        <p>No data on messages acknowledged in time</p>
        {% else %}
        <p>{{ percent_acknowledged }} of messages acknowledged in time</p>
        {% endif %}
        {% endwith %}
    </div>
    <div class="feature">
        {% with percent_addressed=issues_total|true_to_false_percent:'addressed_in_time' %}
        {% if percent_addressed == '-' %}
        <p>No data on messages addressed in time</p>
        {% else %}
        <p>{{ percent_addressed }} of messages addressed to in time</p>
        {% endif %}
        {% endwith %}
    </div>
    {% endif %}
    <div class="feature">
        {% with percent_happy_service=issues_total|true_to_false_percent:'happy_service' %}
        {% if percent_happy_service == '-' %}
        <p>No data on users happy with service</p>
        {% else %}
        <p>{{ percent_happy_service }} of users happy with service</p>
        {% endif %}
        {% endwith %}
    </div>
    <div class="feature">
        {% with percent_happy_outcome=issues_total|true_to_false_percent:'happy_outcome' %}
        {% if percent_happy_outcome == '-' %}
        <p>No data on users happy with outcome</p>
        {% else %}
        <p>{{ percent_happy_outcome }} of users happy with outcome</p>
        {% endif %}
        {% endwith %}
    </div>
</div>
<div class="outcomes-options">
    <form class="" action="{{ request.path }}">
        {% if services %}
        <div class="feature">
            <select name="service">
                <option value="">Department</option>
                {% for service in services %}
                <option value="{{ service.id }}" {% if selected_service == service.id %}selected{% endif %}>{{ service.name }}</option>
                {% endfor %}
            </select>
        </div>
        {% endif %}
        <div class="feature">
            <select name="problems_category">
                <option value="">Problem type</option>
                {% for value, display_value in problems_categories %}
                <option value="{{ value }}" {% if problems_category == value %}selected{% endif %}>{{ display_value }}</option>
                {% endfor %}
            </select>
        </div>
        <div class="feature">
            <select name="questions_category">
                <option value="">Question type</option>
                 {% for value, display_value in questions_categories %}
                    <option value="{{ value }}" {% if questions_category == value %}selected{% endif %}>{{ display_value }}</option>
                {% endfor %}
            </select>
        </div>
        <div class="feature">
            <input type="submit" value="Filter">
        </div>
    </form>
</div>
<div class="outcomes-table">
    <div class="feature">
        <table>
            <thead>
                <tr>
                    <th class="heading separator">Message Type</th>
                    <th>Last 7 days</th>
                    <th>Last 4 weeks</th>
                    <th>Last 6 months</th>
                    <th class="separator">All time</th>
                    {% if organisation.has_time_limits %}
                        <th>% Acknowledged in time</th>
                        <th class="separator">% Addressed in time</th>
                    {% endif %}
                    <th>% Happy with service</th>
                    <th>% Happy with outcome</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td class="heading separator">Total Problems Reported<br/><em>of which:</em></td>
                    <td>{{ problems_total.week }}</td>
                    <td>{{ problems_total.four_weeks }}</td>
                    <td>{{ problems_total.six_months }}</td>
                    <td class="separator">{{ problems_total.all_time }}</td>
                    {% if organisation.has_time_limits %}
                        <td>{{ problems_total|true_to_false_percent:'acknowledged_in_time' }}</td>
                        <td class="separator">{{ problems_total|true_to_false_percent:'addressed_in_time' }}</td>
                    {% endif %}
                    <td>{{ problems_total|true_to_false_percent:'happy_service' }}
                    </td>
                    <td>{{ problems_total|true_to_false_percent:'happy_outcome' }}
                    </td>
                </tr>
                {% for status in problems_by_status %}
                <tr>

                    <td class="heading separator">{{ status.description }}</td>
                    <td>{{ status.week }}</td>
                    <td>{{ status.four_weeks }}</td>
                    <td>{{ status.six_months }}</td>
                    <td class="separator">{{ status.all_time }}</td>
                    {% if organisation.has_time_limits %}
                        <td>{{ status|true_to_false_percent:'acknowledged_in_time' }}</td>
                        <td class="separator">{{ status|true_to_false_percent:'addressed_in_time' }}</td>
                    {% endif %}
                    <td>{{ status|true_to_false_percent:'happy_service' }}</td>
                    <td>{{ status|true_to_false_percent:'happy_outcome' }}</td>
                </tr>
                {% endfor %}

                <tr class="separator">
                    <td class="heading separator">Total Questions Sent<br/><em>of which:</em></td>
                    <td>{{ questions_total.week }}</td>
                    <td>{{ questions_total.four_weeks }}</td>
                    <td>{{ questions_total.six_months }}</td>
                    <td class="separator">{{ questions_total.all_time }}</td>
                    {% if organisation.has_time_limits %}
                        <td>{{ questions_total|true_to_false_percent:'acknowledged_in_time' }}</td>
                        <td class="separator">{{ questions_total|true_to_false_percent:'addressed_in_time' }}</td>
                    {% endif %}
                    <td>{{ questions_total|true_to_false_percent:'happy_service' }}</td>
                    <td>{{ questions_total|true_to_false_percent:'happy_outcome' }}</td>
                </tr>
                {% for status in questions_by_status %}
                <tr>
                    <td class="heading separator">{{ status.description }}</td>
                    <td>{{ status.week }}</td>
                    <td>{{ status.four_weeks}}</td>
                    <td>{{ status.six_months }}</td>
                    <td class="separator">{{ status.all_time }}</td>
                    {% if organisation.has_time_limits %}
                        <td>{{ status|true_to_false_percent:'acknowledged_in_time' }}</td>
                        <td class="separator">{{ status|true_to_false_percent:'addressed_in_time' }}</td>
                    {% endif %}
                    <td>{{ status|true_to_false_percent:'happy_service' }}</td>
                    <td>{{ status|true_to_false_percent:'happy_outcome' }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}
