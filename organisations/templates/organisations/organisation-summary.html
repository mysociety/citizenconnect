{% extends 'base.html' %}
{% load url from future %}
{% block title %}{{ organisation.name }} :: Outcomes Summary{% endblock %}

{% block bodyclasses %}organisation-summary{% endblock %}

{% block content %}
<div class="header">
    <h1>{{ organisation.name }} Outcomes</h1>
</div>
{% include "organisations/includes/summary-tabs.html" with active_tab='summary' %}

<div class="hero">
    <div class="feature">
        <p>96% of message responded to in time</p>
    </div>
    <div class="feature">
        <p>82% of users happy with service</p>
    </div>
</div>
<div class="outcomes-options">
    <form class="" action="{{ request.path }}">
        {% if services %}
        <div class="feature">
            <select name="service">
                <option value="">Department</option>
                {% for service in services %}
                <option value="{{ service.id }}" {% if selected_service == service.id %}selected{% endif %}>{{ service.name }}</option>
                {% endfor %}
            </select>
        </div>
        {% endif %}
        <div class="feature">
            <select name="problems_category">
                <option value="">Problem type</option>
                {% for value, display_value in problems_categories %}
                <option value="{{ value }}" {% if problems_category == value %}selected{% endif %}>{{ display_value }}</option>
                {% endfor %}
            </select>
        </div>
        <div class="feature">
            <select name="questions_category">
                <option value="">Question type</option>
                 {% for value, display_value in questions_categories %}
                    <option value="{{ value }}" {% if questions_category == value %}selected{% endif %}>{{ display_value }}</option>
                {% endfor %}
            </select>
        </div>
        <div class="feature">
            <input type="submit" value="Filter">
        </div>
    </form>
</div>
<div class="outcomes-table">
    <div class="feature">
        <table>
            <thead>
                <tr>
                    <th class="heading separator">Message Type</th>
                    <th>Last 7 days</th>
                    <th>Last 4 weeks</th>
                    <th>Last 6 months</th>
                    <th class="separator">All time</th>
                    {% if organisation.has_time_limits %}
                        <th>% Acknowledged in time</th>
                        <th class="separator">% Addressed in time</th>
                    {% endif %}
                    <th>% Happy with service</th>
                    <th>% Happy with outcome</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td class="heading separator">Total Problems Reported<br/><em>of which:</em></td>
                    <td>{{ problems_total.week }}</td>
                    <td>{{ problems_total.four_weeks }}</td>
                    <td>{{ problems_total.six_months }}</td>
                    <td class="separator">{{ problems_total.all_time }}</td>
                    {% if organisation.has_time_limits %}
                        <td></td>
                        <td class="separator"></td>
                    {% endif %}
                    <td></td>
                    <td></td>
                </tr>
                {% for status in problems_by_status %}
                <tr>

                    <td class="heading separator">{{ status.description }}</td>
                    <td>{{ status.week }}</td>
                    <td>{{ status.four_weeks }}</td>
                    <td>{{ status.six_months }}</td>
                    <td class="separator">{{ status.all_time }}</td>
                    {% if organisation.has_time_limits %}
                        <td></td>
                        <td class="separator"></td>
                    {% endif %}
                    <td></td>
                    <td></td>
                </tr>
                {% endfor %}

                <tr class="separator">
                    <td class="heading separator">Total Questions Sent<br/><em>of which:</em></td>
                    <td>{{ questions_total.week }}</td>
                    <td>{{ questions_total.four_weeks }}</td>
                    <td>{{ questions_total.six_months }}</td>
                    <td class="separator">{{ questions_total.all_time }}</td>
                    {% if organisation.has_time_limits %}
                        <td></td>
                        <td class="separator"></td>
                    {% endif %}
                    <td></td>
                    <td></td>
                </tr>
                {% for status in questions_by_status %}
                <tr>
                    <td class="heading separator">{{ status.description }}</td>
                    <td>{{ status.week }}</td>
                    <td>{{ status.four_weeks}}</td>
                    <td>{{ status.six_months }}</td>
                    <td class="separator">{{ status.all_time }}</td>
                    {% if organisation.has_time_limits %}
                        <td></td>
                        <td class="separator"></td>
                    {% endif %}
                    <td></td>
                    <td></td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
<div class="header">
    <h2>Questions</h2>
</div>
<div class="question-list">
    <div class="feature">
         <table>
            <thead>
                <tr>
                    <th>Ref</th>
                    <th>Received</th>
                    <th>Status</th>
                    <th>Type</th>
                    <th>Department</th>
                    <th>User satisfied?</th>
                    <th>Text snippet</th>
                </tr>
            </thead>
            <tbody>
                {% for question in questions %}
                <tr>
                    <td>{{ question.reference_number }}</td>
                    <td>{{ question.created }}</td>
                    <td>{{ question.get_status_display }}</td>
                    <td>{{ question.get_category_display }}</td>
                    <td>{{ question.service|default_if_none:"" }}</td>
                    <td>TODO</td>
                    <td><a href="{% if private %}{% url 'response-form' message_type='question' pk=question.id %}{% else %}{% url 'question-view' cobrand=cobrand.name pk=question.id %}{% endif %}">{{ question.summary }}</a></td>
                </tr>
                {% endfor %}

            </tbody>
        </table>
    </div>
</div>
{% endblock %}
